{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport BusquedaEnFecha from '../Extras/BusquedaEnFecha';\nimport MensajeInicial from '../Extras/MensajeInicial';\nimport CartasTotales from '../Extras/CartasTotales';\nimport TablaCuentasApartados from './TablaCuentasApartados';\nimport ComprobanteCompra from './ComprobanteCompra';\nimport HttpService from '../../Servicios/HttpService';\nimport Utiles from '../../Servicios/Utiles';\nexport default {\n  name: \"ReporteApartados\",\n  components: {\n    BusquedaEnFecha: BusquedaEnFecha,\n    TablaCuentasApartados: TablaCuentasApartados,\n    MensajeInicial: MensajeInicial,\n    CartasTotales: CartasTotales,\n    ComprobanteCompra: ComprobanteCompra\n  },\n  data: function data() {\n    return {\n      filtros: {\n        fechaInicio: \"\",\n        fechaFin: \"\"\n      },\n      cargando: false,\n      apartados: [],\n      totalesGenerales: [],\n      apartadoSeleccionado: null,\n      mostrarComprobante: false\n    };\n  },\n  mounted: function mounted() {\n    this.obtenerApartados();\n  },\n  methods: {\n    onImpreso: function onImpreso(resultado) {\n      this.mostrarComprobante = resultado;\n    },\n    onGenerarComprobante: function onGenerarComprobante(apartado) {\n      this.apartadoSeleccionado = apartado;\n      this.mostrarComprobante = true;\n    },\n    onLiquidar: function onLiquidar(apartado) {\n      var _this = this;\n\n      this.$buefy.dialog.confirm({\n        message: '¿Liquidar apartado? El cliente debe pagar: $' + apartado.porPagar,\n        cancelText: 'Cancelar',\n        confirmText: 'Liquidar',\n        onConfirm: function onConfirm() {\n          _this.cargando = true;\n          HttpService.registrar('vender.php', {\n            accion: 'abonar',\n            total: apartado.porPagar,\n            id: apartado.id\n          }).then(function (resultado) {\n            if (resultado) {\n              _this.cargando = false;\n\n              _this.$buefy.toast.open(\"Apartado liquidado\");\n\n              _this.obtenerApartados();\n            }\n          });\n        }\n      });\n    },\n    onAbonar: function onAbonar(apartado) {\n      var _this2 = this;\n\n      this.$buefy.dialog.prompt({\n        message: \"Escribe el total del abono. Restan: $\" + apartado.porPagar,\n        cancelText: 'Cancelar',\n        confirmText: 'Abonar',\n        inputAttrs: {\n          type: 'number',\n          placeholder: 'Abono',\n          value: '',\n          min: 1,\n          max: apartado.porPagar\n        },\n        trapFocus: true,\n        onConfirm: function onConfirm(value) {\n          _this2.cargando = true;\n          HttpService.registrar('vender.php', {\n            accion: 'abonar',\n            total: value,\n            id: apartado.id\n          }).then(function (resultado) {\n            if (resultado) {\n              _this2.cargando = false;\n\n              _this2.$buefy.toast.open(\"Abono registrado\");\n\n              _this2.obtenerApartados();\n            }\n          });\n        }\n      });\n    },\n    onBusquedaEnFecha: function onBusquedaEnFecha(fechas) {\n      this.filtros.fechaInicio = fechas[0].toISOString().split('T')[0];\n      this.filtros.fechaFin = fechas[1].toISOString().split('T')[0];\n      this.obtenerApartados();\n    },\n    obtenerApartados: function obtenerApartados() {\n      var _this3 = this;\n\n      this.cargando = true;\n      var payload = {\n        filtros: this.filtros,\n        accion: 'obtener_apartados'\n      };\n      HttpService.obtenerConConsultas('vender.php', payload).then(function (resultado) {\n        _this3.apartados = resultado.apartados;\n        _this3.totalesGenerales = [{\n          nombre: \"# Apartados\",\n          total: _this3.apartados.length,\n          icono: \"wallet-travel\",\n          clase: \"has-text-primary\"\n        }, {\n          nombre: \"Total \",\n          total: '$' + resultado.totalApartados,\n          icono: \"cash-fast\",\n          clase: \"has-text-success\"\n        }, {\n          nombre: \"Por pagar\",\n          total: '$' + resultado.totalPorPagar,\n          icono: \"alert\",\n          clase: \"has-text-danger\"\n        }, {\n          nombre: \"Pagos\",\n          total: '$' + resultado.totalPagos,\n          icono: \"account-cash\",\n          clase: \"has-text-grey-light\"\n        }, {\n          nombre: \"# Productos\",\n          total: Utiles.calcularProductosVendidos(_this3.apartados),\n          icono: \"package-variant\",\n          clase: \"has-text-warning\"\n        }, {\n          nombre: \"Ganancia\",\n          total: '$' + Utiles.calcularTotalGanancia(_this3.apartados),\n          icono: \"currency-usd\",\n          clase: \"has-text-info\"\n        }];\n        _this3.cargando = false;\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;EACAA,wBADA;EAEAC;IAAAC;IAAAC;IAAAC;IAAAC;IAAAC;EAAA,CAFA;EAIAC;IAAA;MACAC;QACAC,eADA;QAEAC;MAFA,CADA;MAKAC,eALA;MAMAC,aANA;MAOAC,oBAPA;MAQAC,0BARA;MASAC;IATA;EAAA,CAJA;EAgBAC,OAhBA,qBAgBA;IACA;EACA,CAlBA;EAoBAC;IACAC,SADA,qBACAC,SADA,EACA;MACA;IACA,CAHA;IAKAC,oBALA,gCAKAC,QALA,EAKA;MACA;MACA;IACA,CARA;IAUAC,UAVA,sBAUAD,QAVA,EAUA;MAAA;;MACA;QACAE,2EADA;QAEAC,sBAFA;QAGAC,uBAHA;QAIAC;UACA;UACAC;YACAC,gBADA;YAEAC,wBAFA;YAGAC;UAHA,GAKAC,IALA,CAKA;YACA;cACA;;cACA;;cACA;YACA;UACA,CAXA;QAYA;MAlBA;IAoBA,CA/BA;IAiCAC,QAjCA,oBAiCAX,QAjCA,EAiCA;MAAA;;MACA;QACAE,oEADA;QAEAC,sBAFA;QAGAC,qBAHA;QAIAQ;UACAC,cADA;UAEAC,oBAFA;UAGAC,SAHA;UAIAC,MAJA;UAKAC;QALA,CAJA;QAWAC,eAXA;QAYAb;UACA;UACAC;YACAC,gBADA;YAEAC,YAFA;YAGAC;UAHA,GAKAC,IALA,CAKA;YACA;cACA;;cACA;;cACA;YACA;UACA,CAXA;QAYA;MA1BA;IA4BA,CA9DA;IAgEAS,iBAhEA,6BAgEAC,MAhEA,EAgEA;MACA;MACA;MACA;IACA,CApEA;IAsEAC,gBAtEA,8BAsEA;MAAA;;MACA;MACA;QACAlC,qBADA;QAEAoB;MAFA;MAIAD,uDACAI,IADA,CACA;QACA;QAEA,2BACA;UAAAY;UAAAd;UAAAe;UAAAC;QAAA,CADA,EAEA;UAAAF;UAAAd;UAAAe;UAAAC;QAAA,CAFA,EAGA;UAAAF;UAAAd;UAAAe;UAAAC;QAAA,CAHA,EAIA;UAAAF;UAAAd;UAAAe;UAAAC;QAAA,CAJA,EAKA;UAAAF;UAAAd;UAAAe;UAAAC;QAAA,CALA,EAMA;UAAAF;UAAAd;UAAAe;UAAAC;QAAA,CANA;QAQA;MACA,CAbA;IAcA;EA1FA;AApBA","names":["name","components","BusquedaEnFecha","TablaCuentasApartados","MensajeInicial","CartasTotales","ComprobanteCompra","data","filtros","fechaInicio","fechaFin","cargando","apartados","totalesGenerales","apartadoSeleccionado","mostrarComprobante","mounted","methods","onImpreso","resultado","onGenerarComprobante","apartado","onLiquidar","message","cancelText","confirmText","onConfirm","HttpService","accion","total","id","then","onAbonar","inputAttrs","type","placeholder","value","min","max","trapFocus","onBusquedaEnFecha","fechas","obtenerApartados","nombre","icono","clase"],"sourceRoot":"src/components/Ventas","sources":["ReporteApartados.vue"],"sourcesContent":["<template>\r\n\t<section>\r\n\t\t<p class=\"title is-1\">Reporte de apartados</p>\r\n         <b-breadcrumb\r\n            align=\"is-left\"\r\n        >\r\n            <b-breadcrumb-item tag='router-link' to=\"/\">Inicio</b-breadcrumb-item>\r\n            <b-breadcrumb-item active>Apartados</b-breadcrumb-item>\r\n            </b-breadcrumb>\r\n        \r\n\t\t<busqueda-en-fecha @seleccionada=\"onBusquedaEnFecha\"/>\r\n\t\t<mensaje-inicial class=\"mt-2\" :titulo=\"'No se han encontrado apartados :('\" :subtitulo=\"'Aquí aparecerán los apartados registrados'\" v-if=\"apartados.length<1\"/>\r\n\t\t<div class=\"mt-2\" v-if=\"apartados.length>0\">\r\n\t\t\t<cartas-totales :totales=\"totalesGenerales\" />\r\n\t\t\t<tabla-cuentas-apartados :datos=\"apartados\" @abonar=\"onAbonar\" @liquidar=\"onLiquidar\" @imprimir=\"onGenerarComprobante\"/>\r\n\t\t</div>\r\n\t\t<comprobante-compra :venta=\"this.apartadoSeleccionado\" :tipo=\"'apartado'\" @impreso=\"onImpreso\" v-if=\"mostrarComprobante\" />\r\n\t\t<b-loading :is-full-page=\"true\" v-model=\"cargando\" :can-cancel=\"false\"></b-loading>\r\n\t</section>\r\n</template>\r\n<script>\r\n\timport BusquedaEnFecha from '../Extras/BusquedaEnFecha'\r\n\timport MensajeInicial from '../Extras/MensajeInicial'\r\n\timport CartasTotales from '../Extras/CartasTotales'\r\n\timport TablaCuentasApartados from './TablaCuentasApartados'\r\n    import ComprobanteCompra from './ComprobanteCompra'\r\n\timport HttpService from '../../Servicios/HttpService'\r\n\timport Utiles from '../../Servicios/Utiles'\r\n\r\n\texport default {\r\n\t\tname: \"ReporteApartados\",\r\n\t\tcomponents: { BusquedaEnFecha, TablaCuentasApartados, MensajeInicial, CartasTotales, ComprobanteCompra },\r\n\r\n\t\tdata:()=>({\r\n\t\t\tfiltros: {\r\n\t\t\t\tfechaInicio: \"\",\r\n\t\t\t\tfechaFin: \"\"\r\n\t\t\t},\r\n\t\t\tcargando: false,\r\n\t\t\tapartados: [],\r\n\t\t\ttotalesGenerales: [],\r\n            apartadoSeleccionado: null,\r\n            mostrarComprobante: false\r\n\t\t}),\r\n\r\n\t\tmounted(){\r\n\t\t\tthis.obtenerApartados()\r\n\t\t},\r\n\r\n\t\tmethods: {\r\n            onImpreso(resultado){\r\n                this.mostrarComprobante = resultado\r\n            },\r\n            \r\n            onGenerarComprobante(apartado){\r\n                this.apartadoSeleccionado = apartado\r\n                this.mostrarComprobante = true\r\n            },\r\n\r\n\t\t\tonLiquidar(apartado) {\r\n                this.$buefy.dialog.confirm({\r\n                    message: '¿Liquidar apartado? El cliente debe pagar: $' + apartado.porPagar,\r\n                    cancelText: 'Cancelar',\r\n                    confirmText: 'Liquidar',\r\n                    onConfirm: () => {\r\n                        this.cargando = true\r\n                        HttpService.registrar('vender.php',{\r\n                            accion: 'abonar',\r\n                            total: apartado.porPagar,\r\n                            id: apartado.id\r\n                        })\r\n                        .then(resultado =>{\r\n                            if(resultado){\r\n                                this.cargando = false\r\n                                this.$buefy.toast.open(`Apartado liquidado`)\r\n                                this.obtenerApartados()\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n            },\r\n\r\n            onAbonar(apartado) {\r\n                this.$buefy.dialog.prompt({\r\n                    message: `Escribe el total del abono. Restan: $` + apartado.porPagar,\r\n                    cancelText: 'Cancelar',\r\n                    confirmText: 'Abonar',\r\n                    inputAttrs: {\r\n                        type: 'number',\r\n                        placeholder: 'Abono',\r\n                        value: '',\r\n                        min: 1,\r\n                        max: apartado.porPagar\r\n                    },\r\n                    trapFocus: true,\r\n                    onConfirm: (value) => {\r\n                        this.cargando = true\r\n                        HttpService.registrar('vender.php',{\r\n                            accion: 'abonar',\r\n                            total: value,\r\n                            id: apartado.id\r\n                        })\r\n                        .then(resultado =>{\r\n                            if(resultado){\r\n                                this.cargando = false\r\n                                this.$buefy.toast.open(`Abono registrado`)\r\n                                this.obtenerApartados()\r\n                            }\r\n                        })\r\n                    }\r\n                })\r\n            },\r\n\r\n\t\t\tonBusquedaEnFecha(fechas){\r\n\t\t\t\tthis.filtros.fechaInicio = fechas[0].toISOString().split('T')[0]\r\n\t\t\t\tthis.filtros.fechaFin = fechas[1].toISOString().split('T')[0]\r\n\t\t\t\tthis.obtenerApartados()\r\n\t\t\t},\r\n\r\n\t\t\tobtenerApartados(){\r\n\t\t\t\tthis.cargando = true\r\n\t\t\t\tlet payload = {\r\n\t\t\t\t\tfiltros: this.filtros,\r\n\t\t\t\t\taccion: 'obtener_apartados'\r\n\t\t\t\t}\r\n\t\t\t\tHttpService.obtenerConConsultas('vender.php', payload)\r\n\t\t\t\t.then(resultado => {\r\n\t\t\t\t\tthis.apartados = resultado.apartados\r\n\r\n\t\t\t\t\tthis.totalesGenerales = [\r\n                        {nombre: \"# Apartados\", total: this.apartados.length, icono: \"wallet-travel\", clase: \"has-text-primary\"},\r\n                        {nombre: \"Total \", total: '$' + resultado.totalApartados, icono: \"cash-fast\", clase: \"has-text-success\"},\r\n                        {nombre: \"Por pagar\", total: '$' + resultado.totalPorPagar, icono: \"alert\", clase: \"has-text-danger\"},\r\n                        {nombre: \"Pagos\", total: '$' + resultado.totalPagos, icono: \"account-cash\", clase: \"has-text-grey-light\"},\r\n                        {nombre: \"# Productos\", total: Utiles.calcularProductosVendidos(this.apartados), icono: \"package-variant\", clase: \"has-text-warning\"},\r\n                        {nombre: \"Ganancia\", total: '$' + Utiles.calcularTotalGanancia(this.apartados), icono: \"currency-usd\", clase: \"has-text-info\"}\r\n                    ]\r\n\t\t\t\t\tthis.cargando = false\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>"]},"metadata":{},"sourceType":"module"}